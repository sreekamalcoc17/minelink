<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.shape.*?>

<StackPane xmlns:fx="http://javafx.com/fxml" fx:controller="com.minelink.controller.MainController"
           styleClass="root-pane">
           
    <!-- Main Content Container -->
    <VBox spacing="0" alignment="TOP_CENTER">
        
        <!-- HEADER -->
        <HBox alignment="CENTER" spacing="20" style="-fx-padding: 30 30 20 30;">
            <VBox alignment="CENTER" spacing="4">
                <Label text="MineLink" styleClass="app-title"/>
                <Label text="Quantum Tunnel" styleClass="subtitle"/>
            </VBox>
        </HBox>

        <!-- DASHBOARD GRID -->
        <HBox spacing="24" VBox.vgrow="ALWAYS" style="-fx-padding: 0 24 24 24;">
            
            <!-- LEFT PANEL: CONFIGURATION -->
            <VBox spacing="28" prefWidth="340" styleClass="sidebar-panel">
                <padding><Insets top="28" right="28" bottom="28" left="28"/></padding>
                
                <!-- MODE SWITCH -->
                <VBox spacing="12">
                    <Label text="Network Mode" styleClass="section-label"/>
                    <fx:define>
                        <ToggleGroup fx:id="modeGroup"/>
                    </fx:define>
                    <HBox spacing="0" styleClass="mode-toggle-container">
                        <ToggleButton fx:id="hostRadio" text="Host" toggleGroup="$modeGroup" 
                                      maxWidth="Infinity" HBox.hgrow="ALWAYS" styleClass="toggle-button"/>
                        <ToggleButton fx:id="clientRadio" text="Join" toggleGroup="$modeGroup" selected="true"
                                      maxWidth="Infinity" HBox.hgrow="ALWAYS" styleClass="toggle-button"/>
                    </HBox>
                </VBox>
                
                <!-- PORT CONFIG -->
                <VBox spacing="10" fx:id="portBox">
                    <Label fx:id="portLabel" text="LAN Port" styleClass="section-label"/>
                    <TextField fx:id="portField" promptText="25565" text="25565" styleClass="text-field"/>
                    <Label fx:id="portDescription" text="Port from Open to LAN screen" styleClass="description-label"/>
                </VBox>
                
                <!-- SHARED FOLDER (Auto-Sync) -->
                <VBox spacing="10">
                    <Label text="Shared Folder (Auto-Sync)" styleClass="section-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <TextField fx:id="sharedFolderField" promptText="Select Google Drive folder..." 
                                   HBox.hgrow="ALWAYS" styleClass="text-field"/>
                        <Button fx:id="browseFolderBtn" onAction="#onBrowseFolder" styleClass="icon-button">
                            <tooltip><Tooltip text="Select Shared Folder"/></tooltip>
                            <graphic>
                                <SVGPath content="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" 
                                         fill="#a1a1aa" scaleX="0.9" scaleY="0.9"/>
                            </graphic>
                        </Button>
                        <Button fx:id="refreshBtn" onAction="#onManualRefresh" styleClass="icon-button">
                            <tooltip><Tooltip text="Force Refresh"/></tooltip>
                            <graphic>
                                <SVGPath content="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" 
                                         fill="#0a84ff" scaleX="0.9" scaleY="0.9"/>
                            </graphic>
                        </Button>
                    </HBox>
                    <Label fx:id="syncStatusLabel" text="Not syncing" 
                           style="-fx-text-fill: #30d158; -fx-font-size: 11px; -fx-font-weight: 600;"/>
                </VBox>

                <Region VBox.vgrow="ALWAYS"/>

                <!-- CONNECTION CODE (IDENTITY) -->
                <VBox spacing="12">
                    <Label text="Your Connection Code" styleClass="section-label"/>
                    
                    <!-- Clickable Code Box -->
                    <StackPane styleClass="code-box" onMouseClicked="#onCopyCode">
                         <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                         <VBox spacing="8" alignment="CENTER">
                             <TextArea fx:id="connectionCodeArea" editable="false" wrapText="true" 
                                       prefRowCount="2" styleClass="code-text" 
                                       style="-fx-background-color: transparent; -fx-padding: 0; -fx-alignment: center;"/>
                             <Button fx:id="copyCodeButton" text="Tap to Copy" onAction="#onCopyCode"
                                     style="-fx-background-color: transparent; -fx-text-fill: #636366; -fx-font-size: 11px; -fx-cursor: hand; -fx-padding: 0;"/>
                         </VBox>
                    </StackPane>
                </VBox>
                
                <!-- MAIN ACTION -->
                <Button fx:id="startButton" text="Start Network" onAction="#onToggleNetwork"
                        styleClass="primary-button" maxWidth="Infinity" prefHeight="52"/>
                        
            </VBox>

            <!-- RIGHT PANEL: PEERS -->
            <VBox spacing="24" HBox.hgrow="ALWAYS" styleClass="glass-panel">
                <padding><Insets top="28" right="28" bottom="28" left="28"/></padding>
                
                <!-- Header -->
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <Label text="Friends" styleClass="header-label"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <HBox spacing="6" alignment="CENTER" style="-fx-background-color: #2c2c2e; -fx-background-radius: 8; -fx-padding: 6 12;">
                        <Label fx:id="peersCountLabel" text="0 Online" style="-fx-text-fill: #30d158; -fx-font-size: 12px; -fx-font-weight: 600;"/>
                    </HBox>
                </HBox>
                
                <!-- ADD PEER -->
                <HBox spacing="12" alignment="CENTER_LEFT">
                    <TextField fx:id="peerCodeField" promptText="Paste friend's connection code" 
                               HBox.hgrow="ALWAYS" styleClass="text-field"/>
                    <Button text="Add" onAction="#onAddPeer" styleClass="primary-button" style="-fx-padding: 12 24;"/>
                </HBox>

                <!-- PEERS LIST -->
                <ScrollPane fx:id="peersScrollPane" fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="scroll-pane">
                    <VBox fx:id="peersContainer" spacing="12" styleClass="peers-container">
                        <!-- Dynamic Peer Cards -->
                    </VBox>
                </ScrollPane>
            </VBox>
        </HBox>
        
        <!-- FOOTER STATS -->
        <HBox spacing="32" styleClass="stats-strip" alignment="CENTER">
             <HBox spacing="8" alignment="CENTER_LEFT">
                 <Label fx:id="statusLabel" text="Ready" styleClass="stat-item"/>
             </HBox>
             <Region HBox.hgrow="ALWAYS"/>
             <HBox spacing="6" alignment="CENTER_LEFT">
                 <Label text="⏱" style="-fx-text-fill: #636366;"/>
                 <Label fx:id="uptimeLabel" text="00:00:00" styleClass="stat-item"/>
             </HBox>
             <HBox spacing="6" alignment="CENTER_LEFT">
                 <Label text="↑" style="-fx-text-fill: #30d158;"/>
                 <Label fx:id="sentLabel" text="0 KB" styleClass="stat-item"/>
             </HBox>
             <HBox spacing="6" alignment="CENTER_LEFT">
                 <Label text="↓" style="-fx-text-fill: #0a84ff;"/>
                 <Label fx:id="receivedLabel" text="0 KB" styleClass="stat-item"/>
             </HBox>
        </HBox>
    </VBox>
</StackPane>
